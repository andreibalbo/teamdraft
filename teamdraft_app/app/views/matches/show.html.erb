<div class="container mt-4">
  <div class="row">
    <div class="col-md-8 offset-md-2">
      <div class="card">
        <div class="card-header">
          <h2>Match Details</h2>
          <h6 class="text-muted">Group: <%= @group.name %></h6>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-md-6">
              <p>
                <strong>Date:</strong>
                <%= @match.datetime.strftime("%Y-%m-%d") %>
              </p>
              <p>
                <strong>Time:</strong>
                <%= @match.datetime.strftime("%H:%M") %>
              </p>
            </div>
          </div>
          <div class="participating-players mt-4">
            <div class="d-flex justify-content-between align-items-center mb-3">
              <h3>Participating Players (<%= @match.participations.count %>)</h3>
              <%= link_to 'Select Players', players_match_path(@match), class: 'button' %>
            </div>
            <% if @match.players.any? %>
              <table class="table">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Position</th>
                    <th>Attack</th>
                    <th>Defense</th>
                    <th>Stamina</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody>
                  <% @match.players.each do |player| %>
                    <tr>
                      <td><%= player.name %></td>
                      <td>
                        <%= player.positioning %>
                        (<%= player.positioning <= 50 ? 'Defensive' : 'Attacking' %>)
                      </td>
                      <td><%= player.attack %></td>
                      <td><%= player.defense %></td>
                      <td><%= player.stamina %></td>
                      <td>
                        <%= link_to 'Remove', '#', 
                            class: 'button',
                            data: { turbo_method: :delete, turbo_confirm: 'Are you sure?' } %>
                      </td>
                    </tr>
                  <% end %>
                </tbody>
              </table>
            <% else %>
              <p class="text-muted">No players added to this match yet.</p>
            <% end %>
          </div>
          <div class="drafts mt-4">
            <div class="d-flex justify-content-between align-items-center mb-3">
              <h3>Team Drafts (<%= @match.drafts.count %>)</h3>
              <%= button_to 'Generate New Draft', 
                    generate_match_drafts_path(@match), 
                    class: 'button',
                    data: { turbo: false } %>
            </div>
            <% if @match.drafts.any? %>
              <table class="table">
                <thead>
                  <tr>
                    <th>#</th>
                    <th>Balance Score</th>
                    <th>Created</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody>
                  <% @match.drafts.order(balance_score: :asc).each do |draft| %>
                    <tr>
                      <td><%= draft.id %></td>
                      <td><%= number_to_percentage(draft.balance_score * 100, precision: 1) %></td>
                      <td><%= draft.created_at.strftime("%Y-%m-%d %H:%M") %></td>
                      <td>
                        <%= link_to 'View', draft_path(draft), class: 'button' %>
                        <%= button_to 'Delete', 
                              match_draft_path(@match, draft),
                              method: :delete,
                              class: 'button button-danger',
                              data: { turbo_confirm: 'Are you sure?' } %>
                      </td>
                    </tr>
                  <% end %>
                </tbody>
              </table>
            <% else %>
              <p class="text-muted">No drafts generated yet.</p>
            <% end %>
          </div>
          <div class="mt-3">
            <%= link_to 'Edit', edit_match_path(@match), class: 'button' %>
            <%= link_to 'Back', group_path(@group), class: 'button' %>
            <%= link_to 'Delete', match_path(@match),
                data: { turbo_method: :delete, turbo_confirm: 'Are you sure?' },
                class: 'button' %>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>